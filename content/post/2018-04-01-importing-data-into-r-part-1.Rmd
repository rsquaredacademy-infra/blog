---
title: "Import Data into R - Part 1"
author: "Aravind Hebbali"
date: '2018-04-01'
twitterImg: /img/import.png
description: "Learn to read data from flat/delimited files into R."
slug: import-data-into-r-part-1
tags:
- import
- readr
topics:
- import
- R
---

## Introduction

In this post, we will learn to:

- read data from flat or delimited files
- handle column names/header
- skip text/info present before data
- specify column/variable types
- read specific columns/variables

## Libraries, Data & Code

We will use the [readr](http://readr.tidyverse.org/index.html) package. The 
data sets can be downloaded from [here](https://github.com/rsquaredacademy/datasets) 
and the codes from [here](https://gist.github.com/aravindhebbali/ade2338fd725438f57345e6bd0bccfac).

```{r library, message=FALSE}
library(readr)
```

## Types of Delimiters

Before we start reading data from files, let us take a quick look at the 
different types of delimiters we have to deal with while reading or importing 
data. In general, it is a good practice to take a quick look at as you will 
clearly know the delimiter used in the file.

#### Comma Separated Values

```{r img1, fig.align='center', echo=FALSE}
knitr::include_graphics('/img/mtcars_comma.png')
```

<br>

### Semi Colon Separated Values

```{r img2, fig.align='center', echo=FALSE}
knitr::include_graphics('/img/mtcars_semicolon.png')
```

<br>

### Space Separated Values

```{r img3, fig.align='center', echo=FALSE}
knitr::include_graphics('/img/mtcars_space.png')
```

<br>

### Tab Separated Values

```{r img4, fig.align='center', echo=FALSE}
knitr::include_graphics('/img/mtcars_tab.png')
```

## Read Data

Let us begin by reading data from a `csv` file using `read_csv()`. 

```{r csv}
read_csv('hsb2.csv')
```

Great! If you see the above output, you have successfully read data into R. If you see an error message (which most of us see when
we are trying to read data for the first time), follow the below instructions:

- check the separator in the file and ensure it is a `comma`
- check the file name
- check the file path i.e. location of the file
- ensure that the file name or path is enclosed in single or double quotes

When you read data using `readr`, it will display the data type detected for each column/variable in the data set. If you want to check the data types before reading the data, use `spec_csv()`. We will learn to specify the column types in the next section.

```{r spec_csv, message=FALSE}
spec_csv('hsb2.csv')
```

## Column Names

In some cases, files do not include column names or headers. If we do not 
indicate the absence of column names, `readr` will treat the first row from 
th data as the column name. Like we said before, it is a good practice to take 
a quick look at the data to check for the presence/absence of column names.

```{r img5, fig.align='center', echo=FALSE}
knitr::include_graphics('/img/mtcars_comma.png')
```

<br>

```{r img6, fig.align='center', echo=FALSE}
knitr::include_graphics('/img/mtcars_column_false.png')
```

<br>

If the column names are absent (i.e. the column names are provided in a 
seprate file), use the `col_names` argument and set it to `FALSE`. Now `readr`
will not convert the first row of data into column name and instead it 
will generate new column names.

```{r col_names, message=FALSE}
read_csv('hsb3.csv', col_names = FALSE)
```

We may not always want to use the column names generated by `readr` and 
instead specify new column names. In such cases, we can use `col_names` to 
supply column names as shown in the below example. Let us reread `hsb3` 
and specify column names.

```{r col_names2, message=FALSE}
cnames <- c("id", "female", "race", "ses", "schtyp", "prog", "read", "write", "math", "science", "socst")
read_csv('hsb3.csv', col_names = cnames)
```

### Skip Lines

In certain files, you will find information related to the data such as:

- the data source
- column names
- column description
- copyright etc.

The data will appear after/below such text/information. While reading data from
such files, we need to skip all the rows where the text is present. If we do 
not skip them, `readr` will consider them as part of the data.

```{r img7, fig.align='center', echo=FALSE, out.width="80%"}
knitr::include_graphics('/img/mtcars_skip.png')
```

<br>

Use `skip` argument to indicate the number of lines/rows to be skipped while 
reading data from a file. For example, if the file has contents other than data 
in the first few lines, we need to skip them before reading the data. In the 
below example, we will skip the first 3 lines as they contain information about 
the data set which we do not need.

```{r skip, message=FALSE}
read_csv('hsb4.csv', skip = 3)
```

### Maximum Lines 

Suppose the data file contains several thousands of rows of data and we do not 
want to read all of it. What can we do in such cases? `readr` allows us to 
specify the maximum number of rows to be read using the `n_max` argument.
Suppose we want to read only 100 rows of data from a file, we can set `n_max` 
equal to 100. In the next example, we will read the first 120 rows from the 
`hsb2` file. If you observe the last row in the output, it says `# ... with 
110 more rows`, indicating that only 120 rows of data has been read from the 
file.

```{r n_max, message=FALSE}
read_csv('hsb2.csv', n_max = 120)
```

### Column Types

If you have observed carefully, when you read data using `readr`, it displays
the column names and column types followed by the first 10 rows of data. 
`readr` determines the data type for each column based on the first 1000 rows 
of data. The data can be of the following types:

- integer
- double (decimal point)
- logical (TRUE/FALSE)
- character (text/string)
- factor (categorical/qualitative)
- date/time

```{r img8, fig.align='center', echo=FALSE}
knitr::include_graphics('/img/column_types_list_canva.png')
```

<br>

Before you read data from a file, use `spec_csv()` to see the data types as 
determined by `readr`. If it determines the data types correctly, you can go
ahead and read the data else we will have to specify the data types and we 
will have to do that for all the columns we want to read and not just for 
those columns whose data type was wrongly determined by `readr`.

To specify the data types, we will use the `col_types` argument and supply it
a list of data types. The data types can be specified using:

- `col_integer()`
- `col_double()`
- `col_factor()`
- `col_logical()`
- `col_character()`
- `col_date()`
- `col_time()`
- `col_datetime()`

While specifying the data types we also need to specify the categories of the 
categorical/qualitative variable. To do that, we use the `levels` argument 
within `col_factor()`. Let us read data from the `hsb2.csv` file to understand
data type specification.

```{r col_types}
read_csv('hsb2.csv', col_types = list(
  col_integer(), col_factor(levels = c(0, 1)), 
  col_factor(levels = c(1, 2, 3, 4)), col_factor(levels = c(1, 2, 3)), 
  col_factor(levels = c(1, 2)), col_factor(levels = c(1, 2, 3)),
  col_integer(), col_integer(), col_integer(), col_integer(),
  col_integer())            
)
```

If we do not specify the data type for all columns, `readr` will return an 
error which leads to the following questions:

1. What if I want to skip a few columns?
2. What if I want to read certain columns only?

### Specific Columns

```{r img9, fig.align='center', echo=FALSE}
knitr::include_graphics('/img/column_objective_function_map.png')
```

<br>

For the first scenario, we can use `col_skip()` i.e. instead of specifying the 
data type, we indicate to `readr` to skip that particular column while reading
the data.

In case of the second scenario, we will use `cols_only()` to specify the 
columns to be read i.e. instead of using `list()` to supply the data types, we 
will use `cols_only()` and provide the following details:

- column name
- column type using `col_types` argument

```{r specific_cols}
read_csv('hsb2.csv', col_types = cols_only(id = col_integer(),
  prog = col_factor(levels = c(1, 2, 3)), read = col_integer())
)
```

If you have a data set with 10 columns and plan to skip only a couple of 
columns, use `col_skip()` instead if you plan to read only a couple of 
columns, use `cols_only()`.

## Summary

```{r img10, fig.align='center', echo=FALSE, out.width="80%"}
knitr::include_graphics('/img/import_funca.png')
```

### Summary

In this post, we explored:

- reading data from flat/delimited files
- indicating the presence/absence of column names
- skipping rows in the presence of text/information
- specifying maximum rows to be read
- specifying column data types
- skipping columns 
- reading specific columns only
    
In the next post, we will explore reading data from excel spreadsheets and other statistical softwares.    
                                                                                
## References

- https://readr.tidyverse.org/
- http://r4ds.had.co.nz/data-import.html