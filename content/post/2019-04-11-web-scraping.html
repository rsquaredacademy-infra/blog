---
title: Practical Introduction to Web Scraping in R
author: Aravind Hebbali
description: "Practical Introduction to Web Scraping in R"
date: '2019-04-11'
slug: web-scraping
topics:
  - rvest
tags:
  - rvest
---



<p><img src="/img/ws_meme.jpg" width="80%" style="display: block; margin: auto;" /></p>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Are you trying to compare price of products across websites? Are you trying to
monitor price changes every hour? Or planning to do some text mining or
sentiment analysis on reviews of products or services? If yes, how would you do
that? How do you get the details available on the website into a format in
which you can analyse it?</p>
<ul>
<li>Can you copy/paste the data from their website?</li>
<li>Can you see some save button?</li>
<li>Can you download the data?</li>
</ul>
<p>Hmmm.. If you have these or similar questions on your mind, you have come to
the right place. In this post, we will learn about web scraping using R. Below
is a video tutorial which covers the intial part of this post.</p>
{{% youtube "l37n_HDD1qs" %}}
<p>The slides used in the above video tutorial can be found
<a href="https://slides.rsquaredacademy.com/web-scraping/web-scraping.html#/section" target="_blank">here</a>.</p>
</div>
<div id="the-what" class="section level2">
<h2>The What?</h2>
<p><img src="/img/blog_ws_what_border.png" width="80%" style="display: block; margin: auto;" /></p>
<p>What exactly is web scraping or web mining or web harvesting? It is a
technique for extracting data from websites. Remember, websites contain wealth
of useful data but designed for human consumption and not data analysis. The
goal of web scraping is to take advantage of the pattern or structure of web
pages to extract and store data in a format suitable for data analysis.</p>
</div>
<div id="the-why" class="section level2">
<h2>The Why?</h2>
<p><img src="/img/blog_ws_why_border.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Now, let us understand why we may have to scrape data from the web.</p>
<ul>
<li><strong>Data Format</strong>: As we said earlier, there is a wealth of data on websites
but designed for human consumption. As such, we cannot use it for data analysis
as it is not in a suitable format/shape/structure.</li>
<li><strong>No copy/paste</strong>: We cannot copy &amp; paste the data into a local file. Even if
we do it, it will not be in the required format for data analysis.</li>
<li><strong>No save/download</strong>: There are no options to save/download the required data
from the websites. We cannot right click and save or click on a download button
to extract the required data.</li>
<li><strong>Automation</strong>: With web scraping, we can automate the process of data
extraction/harvesting.</li>
</ul>
</div>
<div id="the-how" class="section level2">
<h2>The How?</h2>
<p><img src="/img/blog_ws_how_border.png" width="80%" style="display: block; margin: auto;" /></p>
<ul>
<li><strong>robots.txt</strong>: One of the most important and overlooked step is to check the
<strong>robots.txt</strong> file to ensure that we have the permission to access the web
page without violating any terms or conditions. In R, we can do this using the
<a href="https://cran.r-project.org/package=robotstxt" target="_blank">robotstxt</a>
by <a href="https://ropensci.org/" target="_blank">rOpenSci</a>.</li>
<li><strong>Fetch</strong>: The next step is to fetch the web page using the
<a href="https://cran.r-project.org/package=xml2" target="_blank">xml2</a>
package and store it so that we can extract the required data. Remember, you
fetch the page once and store it to avoid fetching multiple times as it may
lead to your IP address being blocked by the owners of the website.</li>
<li><strong>Extract/Store/Analyze</strong>: Now that we have fetched the web page, we will use
<a href="https://rvest.tidyverse.org/" target="_blank">rvest</a> to extract the
data and store it for further analysis.</li>
</ul>
</div>
<div id="use-cases" class="section level2">
<h2>Use Cases</h2>
<p><img src="/img/blog_ws_use_cases_border.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Below are few use cases of web scraping:</p>
<ul>
<li><strong>Contact Scraping</strong>: Locate contact information including email addresses,
phone numbers etc.</li>
<li><strong>Monitoring/Comparing Prices</strong>: How your competitors price their products,
how your prices fit within your industry, and whether there are any
fluctuations that you can take advantage of.</li>
<li><strong>Scraping Reviews/Ratings</strong>: Scrape reviews of product/services and use it
for text mining/sentiment analysis etc.</li>
</ul>
</div>
<div id="things-to-keep-in-mind" class="section level2">
<h2>Things to keep in mind…</h2>
<p><img src="/img/blog_ws_keep_in_mind_border.png" width="80%" style="display: block; margin: auto;" /></p>
<ul>
<li><strong>Static &amp; Well Structured</strong>: Web scraping is best suited for static &amp; well
structured web pages. In one of our case studies, we demonstrate how badly
structured web pages can hamper data extraction.</li>
<li><strong>Code Changes</strong>: The underling HTML code of a web page can change anytime
due to changes in design or for updating details. In such case, your script
will stop working. It is important to identify changes to the web page and
modify the web scraping script accordingly.</li>
<li><strong>API Availability</strong>: In many cases, an API (application programming interface)
is made available by the service provider or organization. It is always
advisable to use the API and avoid web scraping. The
<a href="https://httr.r-lib.org/" target="_blank">httr</a> package has a
nice introduction on interacting with APIs.</li>
<li><strong>IP Blocking</strong>: Do not flood websites with requests as you run the risk of
getting blocked. Have some time gap between request so that your IP address in
not blocked from accessing the website.</li>
<li><strong>robots.txt</strong>: We cannot emphasize this enough, always review the
<strong>robots.txt</strong> file to ensure you are not violating any terms and conditions.</li>
</ul>
</div>
<div id="case-studies" class="section level2">
<h2>Case Studies</h2>
<p><img src="/img/blog_ws_case_studies_border.png" width="80%" style="display: block; margin: auto;" /></p>
<ul>
<li><strong>Best selling mobile phones</strong>: In the first case study, we will scrape the
best selling mobile phones from website of Amazon India and extract the name,
color, rating, number of reviews, real and discounted price.</li>
<li><strong>IMDB top 50 movies</strong>: In this case study we will scrape the IMDB website
to extract the title, year of release, certificate, runtime, genre, rating,
votes and revenue of the top 50 movies.</li>
<li><strong>Most visited websites</strong>: In this case study, we will look at the 50 most
visited websites in the world including the category to which they belong,
average time on site, average pages browsed per vist and bounce rate.</li>
<li><strong>List of RBI governors</strong> : In this final case study, we will scrape the list
of RBI Governors from Wikipedia, and analyze the background from which they
came i.e whether there were more economists or bureaucrats?</li>
</ul>
<hr>
<p><a href="https://www.rsquaredacademy.com/" target="_blank"><img src="/img/ad.png" width="100%" alt="course ad" style="text-decoration: none;"></a></p>
<hr>
</div>
<div id="html-basics" class="section level2">
<h2>HTML Basics</h2>
<p>To be able to scrape data from websites, we need to understand how the web
pages are structured. In this section, we will learn just enough HTML to be
able to start scraping data from websites.</p>
<div id="html-css-javascript" class="section level3">
<h3>HTML, CSS &amp; JAVASCRIPT</h3>
<p><img src="/img/html_css_js_2.png" width="80%" style="display: block; margin: auto;" /></p>
<p>A web page typically is made up of the following:</p>
<ul>
<li><strong>HTML</strong> (Hyper Text Markup Language) takes care of the content. You need to
have a basic knowledge of HTML tags as the content is located with these tags.</li>
<li><strong>CSS</strong> (Cascading Style Sheets) takes care of the appearance of the content.
While you don’t need to look into the CSS of a web page, you should be able to
identify the <strong>id</strong> or <strong>class</strong> that manage the appearance of content.</li>
<li><strong>JS</strong> (Javascript) takes care of the behavior of the web page.</li>
</ul>
</div>
<div id="html-element" class="section level3">
<h3>HTML Element</h3>
<p><img src="/img/blog_ws_html_tags_2_border.png" width="80%" style="display: block; margin: auto;" /></p>
<p>HTML element consists of a start tag and end tag with content inserted in
between. They can be nested and are case insensitive. The tags can have
attributes as shown in the above image. The attributes usually come as
name/value pairs. In the above image, <strong>class</strong> is the attribute name while
<strong>primary</strong> is the attribute value. While scraping data from websites in the
case study, we will use a combination of HTML tags and attributes to locate
the content we want to extract. Below is a list of basic and important HTML
tags you should know before you get started with web scraping.</p>
<p><img src="/img/html_tags.jpg" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="dom" class="section level3">
<h3>DOM</h3>
<p><img src="/img/blog_ws_html_dom_border.png" width="80%" style="display: block; margin: auto;" /></p>
<p><strong>DOM</strong> (Document Object Model) defines the logical structure of a document
and the way it is accessed and manipulated. In the above image, you can see
that HTML is structured as a tree and you trace path to any node or tag. We
will use a similar approach in our case studies. We will try to trace the
content we intend to extract using HTML tags and attributes. If the web page
is well structured, we should be able to locate the content using a unique
combination of tags and attributes.</p>
</div>
<div id="html-attributes" class="section level3">
<h3>HTML Attributes</h3>
<p><img src="/img/blog_ws_html_attributes_crop.png" width="80%" style="display: block; margin: auto;" /></p>
<ul>
<li>all HTML elements can have attributes</li>
<li>they provide additional information about an element</li>
<li>they are always specified in the start tag</li>
<li>usually come in name/value pairs</li>
</ul>
<p>The class attribute is used to define equal styles for elements with same
class name. HTML elements with same class name will have the same format and
style. The <code>id</code> attribute specifies a unique id for an HTML element. It can be
used on any HTML element and is case sensitive. The <code>style</code> attribute sets the
style of an HTML element.</p>
<hr>
<p>
<a href="https://www.youtube.com/user/rsquaredin/" target="_blank"><img src="/img/ad_youtube.png" width="100%" alt="youtube ad" style="text-decoration: none;"></a>
</p>
<hr>
</div>
</div>
<div id="libraries" class="section level2">
<h2>Libraries</h2>
<p>We will use the following R packages in this tutorial.</p>
<pre class="r"><code>library(robotstxt)
library(rvest)
library(selectr)
library(xml2)
library(dplyr)
library(stringr)
library(forcats)
library(magrittr)
library(tidyr)
library(ggplot2)
library(lubridate)
library(tibble)
library(purrr)</code></pre>
</div>
<div id="best-selling-mobile-phones" class="section level2">
<h2>Best Selling Mobile Phones</h2>
<p><img src="/img/blog_ws_cs_top_mobiles_border.png" width="80%" style="display: block; margin: auto;" /></p>
<p>In this first case study, we will scrape the details of best selling smart
phones from <a href="https://www.amazon.in/mobile-phones/b?ie=UTF8&amp;node=1389401031&amp;ref_=nav_shopall_sbc_mobcomp_all_mobiles">Amazon</a>.
Our goal is to extract the following:</p>
<ul>
<li>Brand name</li>
<li>Color</li>
<li>Rating</li>
<li>Number of reviews</li>
<li>Real price</li>
<li>Actual price (after discount)</li>
</ul>
<div id="robotstxt" class="section level3">
<h3>robotstxt</h3>
<p>As mentioned earlier, we will first check if we can scrape data from the web
page using <code>paths_allowed()</code> from the <strong>robotstxt</strong> package. We need to
specify the url of the web page using the <code>paths</code> argument. If we can access
the web page, <code>paths_allowed()</code> will return <code>TRUE</code>, else <code>FALSE</code>.</p>
<pre class="r"><code>paths_allowed(
  paths = c(&quot;https://www.amazon.in/mobile-phones/b?ie=UTF8&amp;node=1389401031&amp;ref_=nav_shopall_sbc_mobcomp_all_mobiles&quot;)
)</code></pre>
<pre><code>## 
 www.amazon.in                      No encoding supplied: defaulting to UTF-8.</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>Since it has returned <code>TRUE</code>, let us go ahead and download the web page using
<code>read_html()</code> from the <strong>xml2</strong> package and store it in <code>top_phones</code>. We do
this to ensure not to make repeated requests to the website which may lead to
our IP address being blocked.</p>
<pre class="r"><code>top_phones &lt;- read_html(&quot;https://www.amazon.in/mobile-phones/b?ie=UTF8&amp;node=1389401031&amp;ref_=nav_shopall_sbc_mobcomp_all_mobiles&quot;)
top_phones</code></pre>
<pre><code>## {xml_document}
## &lt;html class=&quot;a-no-js&quot; data-19ax5a9jf=&quot;dingo&quot;&gt;
## [1] &lt;head&gt;\n&lt;script&gt;var aPageStart = (new Date()).getTime();&lt;/script&gt;&lt;me ...
## [2] &lt;body class=&quot;a-aui_149818-c a-aui_152852-c a-aui_157141-c a-aui_1586 ...</code></pre>
</div>
<div id="brand-name" class="section level3">
<h3>Brand Name</h3>
<p><img src="/img/blog_ws_mobile_brand_name_border.png" width="80%" style="display: block; margin: auto;" /></p>
<p>The first detail we want to extract is the brand name of the phone. If you look
at the HTML code, it is nested within a hyperlink, defined by <code>&lt;a&gt;</code>. The link
is inside a section identified by the class <code>crwTitle</code>. We will use this
information to ask <strong>rvest</strong> to extract text content which will give us the
brand name.</p>
<p>The location is specified using <code>html_nodes()</code> and the text extracted using
<code>hmtl_text()</code>. Since <code>crwTitle</code> is a class, we use <code>.</code> before it but not for
<code>a</code> as it is a HTML tag. Both the class and the tag are specified within quotes
and separated by space.</p>
<pre class="r"><code>top_phones %&gt;%
  html_nodes(&quot;.crwTitle a&quot;) %&gt;%
  html_text() </code></pre>
<pre><code>##  [1] &quot;Samsung Galaxy M30 (Gradation Blue, 4+64 GB)&quot;      
##  [2] &quot;Samsung Galaxy M20 (Ocean Blue, 4+64GB)&quot;           
##  [3] &quot;Samsung Galaxy M30 (Gradation Black, 4+64 GB)&quot;     
##  [4] &quot;Redmi 6A (Black, 2GB RAM, 16GB Storage)&quot;           
##  [5] &quot;Redmi 6 Pro (Black, 3GB RAM, 32GB Storage)&quot;        
##  [6] &quot;Samsung Galaxy M10 (Ocean Blue, 3+32GB)&quot;           
##  [7] &quot;Redmi 6 Pro (Black, 4GB RAM, 64GB Storage)&quot;        
##  [8] &quot;Realme U1 (Ambitious Black, 3GB RAM, 32GB Storage)&quot;
##  [9] &quot;Honor 8C (Blue, 4GB RAM, 32GB Storage)&quot;            
## [10] &quot;OnePlus 6T (Mirror Black, 6GB RAM, 128GB Storage)&quot;</code></pre>
<p>If you observe the output, it includes the following:</p>
<ul>
<li>brand name</li>
<li>color</li>
<li>RAM</li>
<li>storage capacity</li>
</ul>
<p>To extract the brand name, we will do the following:</p>
<ul>
<li>use <code>str_split()</code> from <strong>stringr</strong> and specify the pattern <code>\\(</code> i.e split
the string @ the first opening bracket. Since <code>(</code> is a special character, we
use <code>\\</code> for escaping.</li>
<li>next, we use <code>map_chr()</code> from the <strong>purrr</strong> package to extract the first
element from the resulting list.</li>
<li>finally, we remove the white space using <code>str_trim()</code>.</li>
</ul>
<p>The whole point of the above exercise is to show that extracting the data
using <strong>rvest</strong> is just one part of web scraping. We need to spend enough
time tidying and reshaping the data to get it into a format useful for data
analysis.</p>
<pre class="r"><code>top_phones %&gt;%
  html_nodes(&quot;.crwTitle a&quot;) %&gt;%
  html_text() %&gt;%
  str_split(&#39;\\(&#39;) %&gt;%
  map_chr(1) %&gt;%
  str_trim() -&gt; mobile_name

mobile_name</code></pre>
<pre><code>##  [1] &quot;Samsung Galaxy M30&quot; &quot;Samsung Galaxy M20&quot; &quot;Samsung Galaxy M30&quot;
##  [4] &quot;Redmi 6A&quot;           &quot;Redmi 6 Pro&quot;        &quot;Samsung Galaxy M10&quot;
##  [7] &quot;Redmi 6 Pro&quot;        &quot;Realme U1&quot;          &quot;Honor 8C&quot;          
## [10] &quot;OnePlus 6T&quot;</code></pre>
</div>
<div id="color" class="section level3">
<h3>Color</h3>
<p><img src="/img/blog_ws_mobile_color_border.png" width="80%" style="display: block; margin: auto;" /></p>
<p>In the previous step, we observed that the data extracted from <code>top_mobiles</code>
included the color of the mobile as well. So the location of the color in
the HTML is same; within the hyperlink of the <code>crwTitle</code> section. But now,
we want to extract the color and not the brand name.</p>
<pre class="r"><code>top_phones %&gt;%
  html_nodes(&quot;.crwTitle a&quot;) %&gt;%
  html_text() </code></pre>
<pre><code>##  [1] &quot;Samsung Galaxy M30 (Gradation Blue, 4+64 GB)&quot;      
##  [2] &quot;Samsung Galaxy M20 (Ocean Blue, 4+64GB)&quot;           
##  [3] &quot;Samsung Galaxy M30 (Gradation Black, 4+64 GB)&quot;     
##  [4] &quot;Redmi 6A (Black, 2GB RAM, 16GB Storage)&quot;           
##  [5] &quot;Redmi 6 Pro (Black, 3GB RAM, 32GB Storage)&quot;        
##  [6] &quot;Samsung Galaxy M10 (Ocean Blue, 3+32GB)&quot;           
##  [7] &quot;Redmi 6 Pro (Black, 4GB RAM, 64GB Storage)&quot;        
##  [8] &quot;Realme U1 (Ambitious Black, 3GB RAM, 32GB Storage)&quot;
##  [9] &quot;Honor 8C (Blue, 4GB RAM, 32GB Storage)&quot;            
## [10] &quot;OnePlus 6T (Mirror Black, 6GB RAM, 128GB Storage)&quot;</code></pre>
<p>We will split the original string @ <code>(</code> and extract the second part which
includes:</p>
<ul>
<li>color</li>
<li>RAM</li>
<li>storage capacity</li>
</ul>
<p>The color is separated from the rest by a comma. We will use the <code>,</code> to split
the string and extract the color using <code>map_chr()</code> i.e. extract the first
element from the resulting list.</p>
<pre class="r"><code>top_phones %&gt;%
  html_nodes(&quot;.crwTitle a&quot;) %&gt;%
  html_text() %&gt;%
  str_split(&#39;\\(&#39;) %&gt;%
  map_chr(2) %&gt;%
  str_split(&quot;,&quot;) %&gt;%
  map_chr(1) -&gt; mobile_color

mobile_color</code></pre>
<pre><code>##  [1] &quot;Gradation Blue&quot;  &quot;Ocean Blue&quot;      &quot;Gradation Black&quot;
##  [4] &quot;Black&quot;           &quot;Black&quot;           &quot;Ocean Blue&quot;     
##  [7] &quot;Black&quot;           &quot;Ambitious Black&quot; &quot;Blue&quot;           
## [10] &quot;Mirror Black&quot;</code></pre>
</div>
<div id="rating" class="section level3">
<h3>Rating</h3>
<p><img src="/img/blog_ws_mobile_rating_border.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Let us extract the ratings for the phones now. If you look at the HTML code,
we can locate rating within the following:</p>
<ul>
<li><code>&lt;span&gt;</code></li>
<li><code>&lt;a&gt;</code></li>
<li><code>.crwProductDetail</code></li>
</ul>
<p>It is wrapped within <code>&lt;span&gt;</code> identified by the class <code>.a-icon-alt</code> which is
inside a hyperlink in the section identified by the class <code>.crwProductDetail</code>.</p>
<pre class="r"><code>top_phones %&gt;%
  html_nodes(&quot;.crwProductDetail span .a-icon-alt&quot;) %&gt;%
  html_text() </code></pre>
<pre><code>##  [1] &quot;4.0 out of 5 stars&quot; &quot;3.7 out of 5 stars&quot; &quot;4.1 out of 5 stars&quot;
##  [4] &quot;4.2 out of 5 stars&quot; &quot;4.2 out of 5 stars&quot; &quot;4.1 out of 5 stars&quot;
##  [7] &quot;4.1 out of 5 stars&quot; &quot;4.4 out of 5 stars&quot; &quot;4.2 out of 5 stars&quot;
## [10] &quot;4.5 out of 5 stars&quot;</code></pre>
<p>In the outptut, you can observe the text <strong>out of 5 stars</strong> for each rating.
Let us get rid of this text by selecting the first 3 characters using
<code>str_sub()</code>. We pick the first 3 characters using the <code>start</code> and <code>end</code>
arguments and supply them the values <code>1</code> and <code>3</code>. Finally, we convert the
rating to a number using <code>as.numeric()</code>.</p>
<pre class="r"><code>top_phones %&gt;%
  html_nodes(&quot;.crwProductDetail span .a-icon-alt&quot;) %&gt;%
  html_text() %&gt;%
  str_sub(start = 1, end = 3) %&gt;%
  as.numeric() -&gt; mobile_rating

mobile_rating</code></pre>
<pre><code>##  [1] 4.0 3.7 4.1 4.2 4.2 4.1 4.1 4.4 4.2 4.5</code></pre>
</div>
<div id="number-of-reviews" class="section level3">
<h3>Number of Reviews</h3>
<p><img src="/img/blog_ws_mobile_reviews_border.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Now that we know the rating for each of the top 10 best selling smart phones,
let us find out how many people have reviewed them. The number of reviews is
located within the following:</p>
<ul>
<li>hyperlink identified by the class <code>.a-link-normal</code></li>
<li><code>&lt;span&gt;</code> tag identified by the class <code>.a-size-small</code></li>
<li>section identified by the class <code>.crwProductDetail</code></li>
</ul>
<pre class="r"><code>top_phones %&gt;%
  html_nodes(&quot;.crwProductDetail span.a-size-small .a-link-normal&quot;) %&gt;%
  html_text() </code></pre>
<pre><code>##  [1] &quot;1,100&quot;  &quot;12,060&quot; &quot;553&quot;    &quot;23,487&quot; &quot;6,403&quot;  &quot;3,013&quot;  &quot;12,366&quot;
##  [8] &quot;10,413&quot; &quot;822&quot;    &quot;14,379&quot;</code></pre>
<p>We use the above information within <code>html_nodes()</code> to extract the data. Now
let us clean it up a bit and convert it into a number instead of leaving it
as a character. If you use <code>as.numeric()</code> directly, you will see <code>NA</code> in
the result, the reason being the presence of comma in the number of reviews.
First, we need to get rid of the comma, which we will do using <code>str_replace()</code>.
We replace the comma with nothing as shown in the code below and then convert
it into a number.</p>
<pre class="r"><code>top_phones %&gt;%
  html_nodes(&quot;.crwProductDetail span.a-size-small .a-link-normal&quot;) %&gt;%
  html_text() %&gt;%
  str_replace(&quot;,&quot;, &quot;&quot;) %&gt;%
  as.numeric() -&gt; mobile_review

mobile_review</code></pre>
<pre><code>##  [1]  1100 12060   553 23487  6403  3013 12366 10413   822 14379</code></pre>
</div>
<div id="real-price" class="section level3">
<h3>Real Price</h3>
<p><img src="/img/blog_ws_real_price_border.png" width="80%" style="display: block; margin: auto;" /></p>
<p>The price is one of the most important factor when it comes to choosing a
smart phone. Let us look at the price of the best selling mobile phones. Again,
looking at the HTML code, the price can be located within the following:</p>
<ul>
<li><code>&lt;span&gt;</code> tag identified by the class <code>.a-text-strike</code></li>
<li>section identified by the class <code>crwPrice</code> and <code>.crwProductDetail</code></li>
</ul>
<pre class="r"><code>top_phones %&gt;%
  html_nodes(&quot;.crwProductDetail .crwPrice .a-text-strike&quot;) %&gt;%
  html_text() </code></pre>
<pre><code>##  [1] &quot;  Rs. 16,490.00&quot; &quot;  Rs. 13,390.00&quot; &quot;  Rs. 16,490.00&quot;
##  [4] &quot;  Rs. 6,999.00&quot;  &quot;  Rs. 11,499.00&quot; &quot;  Rs. 9,290.00&quot; 
##  [7] &quot;  Rs. 13,499.00&quot; &quot;  Rs. 12,999.00&quot; &quot;  Rs. 12,999.00&quot;
## [10] &quot;  Rs. 37,999.00&quot;</code></pre>
<p>Using the above information, we can extract the price of the mobile phones
which is returned as a character vector but we need to convert it to numeric
if we are to analyze it further. Let use convert the price to a number using
the following steps:</p>
<ul>
<li>use <code>str_trim()</code> to remove the white spaces</li>
<li>exclude the currency information using <code>str_sub()</code></li>
<li>replace the comma using <code>str_replace()</code></li>
<li>remove the decimal values using <code>str_split()</code></li>
<li>extract the price from the resulting list using <code>map_chr()</code></li>
<li>convert the price to a number <code>using as.numeric()</code></li>
</ul>
<pre class="r"><code>top_phones %&gt;%
  html_nodes(&quot;.crwProductDetail .crwPrice .a-text-strike&quot;) %&gt;%
  html_text() %&gt;%
  str_trim() %&gt;%
  str_sub(start = 5) %&gt;%
  str_replace(&quot;,&quot;, &quot;&quot;) %&gt;%
  str_split(&quot;\\.&quot;) %&gt;%
  map_chr(1) %&gt;%
  as.numeric() -&gt; real_price

real_price</code></pre>
<pre><code>##  [1] 16490 13390 16490  6999 11499  9290 13499 12999 12999 37999</code></pre>
</div>
<div id="actual-price" class="section level3">
<h3>Actual Price</h3>
<p><img src="/img/blog_ws_actual_price_border.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Deep discounts are one of the strategies adopted by ecommerce firms to drive
sales. Let us look at the actual price (after discount price) of the best
selling mobile phones. The discounted price can be located within the
following:</p>
<ul>
<li><code>&lt;span&gt;</code> tag identified by the class <code>.crwActualPrice</code></li>
<li>section identified by the class <code>crwPrice</code> and <code>.crwProductDetail</code></li>
</ul>
<p>Using the above information, we can extract the discounted price of the mobile
phones.</p>
<pre class="r"><code>top_phones %&gt;%
  html_nodes(&quot;.crwProductDetail .crwActualPrice&quot;) %&gt;%
  html_text() </code></pre>
<pre><code>##  [1] &quot;  Rs. 14,990.00&quot; &quot;  Rs. 12,990.00&quot; &quot;  Rs. 14,990.00&quot;
##  [4] &quot;  Rs. 5,999.00&quot;  &quot;  Rs. 7,999.00&quot;  &quot;  Rs. 8,990.00&quot; 
##  [7] &quot;  Rs. 10,000.00&quot; &quot;  Rs. 9,999.00&quot;  &quot;  Rs. 10,999.00&quot;
## [10] &quot;  Rs. 34,999.00&quot;</code></pre>
<p>Let use convert the price to a number using the same steps as in the
case of real price.</p>
<pre class="r"><code>top_phones %&gt;%
  html_nodes(&quot;.crwProductDetail .crwActualPrice&quot;) %&gt;%
  html_text() %&gt;%
  str_trim() %&gt;%
  str_sub(start = 5) %&gt;%
  str_replace(&quot;,&quot;, &quot;&quot;) %&gt;%
  str_split(&quot;\\.&quot;) %&gt;%
  map_chr(1) %&gt;%
  as.numeric() -&gt; discounted_price

discounted_price</code></pre>
<pre><code>##  [1] 14990 12990 14990  5999  7999  8990 10000  9999 10999 34999</code></pre>
</div>
<div id="putting-it-all-together" class="section level3">
<h3>Putting it all together…</h3>
<pre class="r"><code>best_sellers &lt;- tibble(title = mobile_name, color = mobile_color, 
  rating = mobile_rating, reviews = mobile_review, `Real Price (Rs.)` = real_price,
  `Discount Price (Rs.)` = discounted_price)

best_sellers</code></pre>
<pre><code>## # A tibble: 10 x 6
##    title       color     rating reviews `Real Price (Rs~ `Discount Price (~
##    &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;            &lt;dbl&gt;              &lt;dbl&gt;
##  1 Samsung Ga~ Gradatio~    4      1100            16490              14990
##  2 Samsung Ga~ Ocean Bl~    3.7   12060            13390              12990
##  3 Samsung Ga~ Gradatio~    4.1     553            16490              14990
##  4 Redmi 6A    Black        4.2   23487             6999               5999
##  5 Redmi 6 Pro Black        4.2    6403            11499               7999
##  6 Samsung Ga~ Ocean Bl~    4.1    3013             9290               8990
##  7 Redmi 6 Pro Black        4.1   12366            13499              10000
##  8 Realme U1   Ambitiou~    4.4   10413            12999               9999
##  9 Honor 8C    Blue         4.2     822            12999              10999
## 10 OnePlus 6T  Mirror B~    4.5   14379            37999              34999</code></pre>
<hr>
<p><a href="https://apps.rsquaredacademy.com/" target="_blank"><img src="/img/ad_apps.png" width="100%" alt="apps ad" style="text-decoration: none;"></a></p>
<hr>
</div>
</div>
<div id="imdb-top-50" class="section level2">
<h2>IMDB Top 50</h2>
<p><img src="/img/blog_ws_cs_imdb_top_50_border.png" width="80%" style="display: block; margin: auto;" /></p>
<p>In this case study, we will extract the following details of the top 50 movies
from the IMDB website:</p>
<ul>
<li>title</li>
<li>year of release</li>
<li>certificate</li>
<li>runtime</li>
<li>genre</li>
<li>rating</li>
<li>votes</li>
<li>revenue</li>
</ul>
<div id="robotstxt-1" class="section level3">
<h3>robotstxt</h3>
<p>Let us check if we can scrape the data from the website using <code>paths_allowed()</code>
from <strong>robotstxt</strong> package.</p>
<pre class="r"><code>paths_allowed(
  paths = c(&quot;https://www.imdb.com/search/title?groups=top_250&amp;sort=user_rating&quot;)
)</code></pre>
<pre><code>## 
 www.imdb.com                      No encoding supplied: defaulting to UTF-8.</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>Since it has returned <code>TRUE</code>, we will go ahead and download the web page using
<code>read_html()</code> from <strong>xml2</strong> package.</p>
<pre class="r"><code>imdb &lt;- read_html(&quot;https://www.imdb.com/search/title?groups=top_250&amp;sort=user_rating&quot;)
imdb</code></pre>
<pre><code>## {xml_document}
## &lt;html xmlns:og=&quot;http://ogp.me/ns#&quot; xmlns:fb=&quot;http://www.facebook.com/2008/fbml&quot;&gt;
## [1] &lt;head&gt;\n&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset= ...
## [2] &lt;body id=&quot;styleguide-v2&quot; class=&quot;fixed&quot;&gt;\n\n            &lt;img height=&quot; ...</code></pre>
</div>
<div id="title" class="section level3">
<h3>Title</h3>
<p><img src="/img/blog_ws_imdb_movie_name_border.png" width="80%" style="display: block; margin: auto;" /></p>
<p>As we did in the previous case study, we will look at the HTML code of the IMDB
web page and locate the title of the movies in the following way:</p>
<ul>
<li>hyperlink inside <code>&lt;h3&gt;</code> tag</li>
<li>section identified with the class <code>.lister-item-content</code></li>
</ul>
<p>In other words, the title of the movie is inside a hyperlink (<code>&lt;a&gt;</code>) which
is inside a level 3 heading (<code>&lt;h3&gt;</code>) within a section identified by the class
<code>.lister-item-content</code>.</p>
<pre class="r"><code>imdb %&gt;%
  html_nodes(&quot;.lister-item-content h3 a&quot;) %&gt;%
  html_text() -&gt; movie_title

movie_title</code></pre>
<pre><code>##  [1] &quot;The Shawshank Redemption&quot;                         
##  [2] &quot;The Godfather&quot;                                    
##  [3] &quot;The Dark Knight&quot;                                  
##  [4] &quot;The Godfather: Part II&quot;                           
##  [5] &quot;The Lord of the Rings: The Return of the King&quot;    
##  [6] &quot;Pulp Fiction&quot;                                     
##  [7] &quot;Schindler&#39;s List&quot;                                 
##  [8] &quot;Il buono, il brutto, il cattivo&quot;                  
##  [9] &quot;12 Angry Men&quot;                                     
## [10] &quot;Inception&quot;                                        
## [11] &quot;Fight Club&quot;                                       
## [12] &quot;The Lord of the Rings: The Fellowship of the Ring&quot;
## [13] &quot;Forrest Gump&quot;                                     
## [14] &quot;The Lord of the Rings: The Two Towers&quot;            
## [15] &quot;The Matrix&quot;                                       
## [16] &quot;Goodfellas&quot;                                       
## [17] &quot;Star Wars: Episode V - The Empire Strikes Back&quot;   
## [18] &quot;One Flew Over the Cuckoo&#39;s Nest&quot;                  
## [19] &quot;Shichinin no samurai&quot;                             
## [20] &quot;Interstellar&quot;                                     
## [21] &quot;Cidade de Deus&quot;                                   
## [22] &quot;Sen to Chihiro no kamikakushi&quot;                    
## [23] &quot;Saving Private Ryan&quot;                              
## [24] &quot;The Green Mile&quot;                                   
## [25] &quot;La vita è bella&quot;                                  
## [26] &quot;The Usual Suspects&quot;                               
## [27] &quot;Se7en&quot;                                            
## [28] &quot;Léon&quot;                                             
## [29] &quot;The Silence of the Lambs&quot;                         
## [30] &quot;Star Wars&quot;                                        
## [31] &quot;It&#39;s a Wonderful Life&quot;                            
## [32] &quot;Andhadhun&quot;                                        
## [33] &quot;Dangal&quot;                                           
## [34] &quot;Spider-Man: Into the Spider-Verse&quot;                
## [35] &quot;Avengers: Infinity War&quot;                           
## [36] &quot;Whiplash&quot;                                         
## [37] &quot;The Intouchables&quot;                                 
## [38] &quot;The Prestige&quot;                                     
## [39] &quot;The Departed&quot;                                     
## [40] &quot;The Pianist&quot;                                      
## [41] &quot;Memento&quot;                                          
## [42] &quot;Gladiator&quot;                                        
## [43] &quot;American History X&quot;                               
## [44] &quot;The Lion King&quot;                                    
## [45] &quot;Terminator 2: Judgment Day&quot;                       
## [46] &quot;Nuovo Cinema Paradiso&quot;                            
## [47] &quot;Hotaru no haka&quot;                                   
## [48] &quot;Back to the Future&quot;                               
## [49] &quot;Raiders of the Lost Ark&quot;                          
## [50] &quot;Apocalypse Now&quot;</code></pre>
</div>
<div id="year-of-release" class="section level3">
<h3>Year of Release</h3>
<p><img src="/img/blog_ws_imdb_movie_year_border.png" width="80%" style="display: block; margin: auto;" /></p>
<p>The year in which a movie was released can be located in the following way:</p>
<ul>
<li><code>&lt;span&gt;</code> tag identified by the class <code>.lister-item-year</code></li>
<li>nested inside a level 3 heading (<code>&lt;h3&gt;</code>)</li>
<li>part of section identified by the class <code>.lister-item-content</code></li>
</ul>
<pre class="r"><code>imdb %&gt;%
  html_nodes(&quot;.lister-item-content h3 .lister-item-year&quot;) %&gt;%
  html_text() </code></pre>
<pre><code>##  [1] &quot;(1994)&quot; &quot;(1972)&quot; &quot;(2008)&quot; &quot;(1974)&quot; &quot;(2003)&quot; &quot;(1994)&quot; &quot;(1993)&quot;
##  [8] &quot;(1966)&quot; &quot;(1957)&quot; &quot;(2010)&quot; &quot;(1999)&quot; &quot;(2001)&quot; &quot;(1994)&quot; &quot;(2002)&quot;
## [15] &quot;(1999)&quot; &quot;(1990)&quot; &quot;(1980)&quot; &quot;(1975)&quot; &quot;(1954)&quot; &quot;(2014)&quot; &quot;(2002)&quot;
## [22] &quot;(2001)&quot; &quot;(1998)&quot; &quot;(1999)&quot; &quot;(1997)&quot; &quot;(1995)&quot; &quot;(1995)&quot; &quot;(1994)&quot;
## [29] &quot;(1991)&quot; &quot;(1977)&quot; &quot;(1946)&quot; &quot;(2018)&quot; &quot;(2016)&quot; &quot;(2018)&quot; &quot;(2018)&quot;
## [36] &quot;(2014)&quot; &quot;(2011)&quot; &quot;(2006)&quot; &quot;(2006)&quot; &quot;(2002)&quot; &quot;(2000)&quot; &quot;(2000)&quot;
## [43] &quot;(1998)&quot; &quot;(1994)&quot; &quot;(1991)&quot; &quot;(1988)&quot; &quot;(1988)&quot; &quot;(1985)&quot; &quot;(1981)&quot;
## [50] &quot;(1979)&quot;</code></pre>
<p>If you look at the output, the year is enclosed in round brackets and is a
character vector. We need to do 2 things now:</p>
<ul>
<li>remove the round bracket</li>
<li>convert year to class <code>Date</code> instead of character</li>
</ul>
<p>We will use <code>str_sub()</code> to extract the year and convert it to <code>Date</code> using
<code>as.Date()</code> with the format <code>%Y</code>. Finally, we use <code>year()</code> from <strong>lubridate</strong>
package to extract the year from the previous step.</p>
<pre class="r"><code>imdb %&gt;%
  html_nodes(&quot;.lister-item-content h3 .lister-item-year&quot;) %&gt;%
  html_text() %&gt;%
  str_sub(start = 2, end = 5) %&gt;%
  as.Date(format = &quot;%Y&quot;) %&gt;%
  year() -&gt; movie_year

movie_year</code></pre>
<pre><code>##  [1] 1994 1972 2008 1974 2003 1994 1993 1966 1957 2010 1999 2001 1994 2002
## [15] 1999 1990 1980 1975 1954 2014 2002 2001 1998 1999 1997 1995 1995 1994
## [29] 1991 1977 1946 2018 2016 2018 2018 2014 2011 2006 2006 2002 2000 2000
## [43] 1998 1994 1991 1988 1988 1985 1981 1979</code></pre>
</div>
<div id="certificate" class="section level3">
<h3>Certificate</h3>
<p><img src="/img/blog_ws_imdb_movie_certificate_border.png" width="80%" style="display: block; margin: auto;" /></p>
<p>The certificate given to the movie can be located in the following way:</p>
<ul>
<li><code>&lt;span&gt;</code> tag identified by the class <code>.certificate</code></li>
<li>nested inside a paragraph (<code>&lt;p&gt;</code>)</li>
<li>part of section identified by the class <code>.lister-item-content</code></li>
</ul>
<pre class="r"><code>imdb %&gt;%
  html_nodes(&quot;.lister-item-content p .certificate&quot;) %&gt;%
  html_text() -&gt; movie_certificate

movie_certificate</code></pre>
<pre><code>##  [1] &quot;A&quot;     &quot;A&quot;     &quot;UA&quot;    &quot;PG-13&quot; &quot;A&quot;     &quot;A&quot;     &quot;UA&quot;    &quot;A&quot;    
##  [9] &quot;PG-13&quot; &quot;PG-13&quot; &quot;PG-13&quot; &quot;A&quot;     &quot;A&quot;     &quot;PG&quot;    &quot;UA&quot;    &quot;R&quot;    
## [17] &quot;PG&quot;    &quot;A&quot;     &quot;A&quot;     &quot;PG-13&quot; &quot;A&quot;     &quot;R&quot;     &quot;A&quot;     &quot;A&quot;    
## [25] &quot;U&quot;     &quot;PG&quot;    &quot;UA&quot;    &quot;U&quot;     &quot;U&quot;     &quot;UA&quot;    &quot;A&quot;     &quot;UA&quot;   
## [33] &quot;PG-13&quot; &quot;A&quot;     &quot;R&quot;     &quot;R&quot;     &quot;R&quot;     &quot;A&quot;     &quot;U&quot;     &quot;U&quot;    
## [41] &quot;R&quot;     &quot;U&quot;     &quot;PG&quot;    &quot;R&quot;</code></pre>
</div>
<div id="runtime" class="section level3">
<h3>Runtime</h3>
<p><img src="/img/blog_ws_imdb_movie_runtime_border.png" width="80%" style="display: block; margin: auto;" /></p>
<p>The runtime of the movie can be located in the following way:</p>
<ul>
<li><code>&lt;span&gt;</code> tag identified by the class <code>.runtime</code></li>
<li>nested inside a paragraph (<code>&lt;p&gt;</code>)</li>
<li>part of section identified by the class <code>.lister-item-content</code></li>
</ul>
<pre class="r"><code>imdb %&gt;%
  html_nodes(&quot;.lister-item-content p .runtime&quot;) %&gt;%
  html_text() </code></pre>
<pre><code>##  [1] &quot;142 min&quot; &quot;175 min&quot; &quot;152 min&quot; &quot;202 min&quot; &quot;201 min&quot; &quot;154 min&quot; &quot;195 min&quot;
##  [8] &quot;161 min&quot; &quot;96 min&quot;  &quot;148 min&quot; &quot;139 min&quot; &quot;178 min&quot; &quot;142 min&quot; &quot;179 min&quot;
## [15] &quot;136 min&quot; &quot;146 min&quot; &quot;124 min&quot; &quot;133 min&quot; &quot;207 min&quot; &quot;169 min&quot; &quot;130 min&quot;
## [22] &quot;125 min&quot; &quot;169 min&quot; &quot;189 min&quot; &quot;116 min&quot; &quot;106 min&quot; &quot;127 min&quot; &quot;110 min&quot;
## [29] &quot;118 min&quot; &quot;121 min&quot; &quot;130 min&quot; &quot;139 min&quot; &quot;161 min&quot; &quot;117 min&quot; &quot;149 min&quot;
## [36] &quot;106 min&quot; &quot;112 min&quot; &quot;130 min&quot; &quot;151 min&quot; &quot;150 min&quot; &quot;113 min&quot; &quot;155 min&quot;
## [43] &quot;119 min&quot; &quot;88 min&quot;  &quot;137 min&quot; &quot;155 min&quot; &quot;89 min&quot;  &quot;116 min&quot; &quot;115 min&quot;
## [50] &quot;147 min&quot;</code></pre>
<p>If you look at the output, it includes the text <strong>min</strong> and is of type
<code>character</code>. We need to do 2 things here:</p>
<ul>
<li>remove the text <strong>min</strong></li>
<li>convert to type <code>numeric</code></li>
</ul>
<p>We will try the following:</p>
<ul>
<li>use <code>str_split()</code> to split the result using space as a separator</li>
<li>extract the first element from the resulting list using <code>map_chr()</code></li>
<li>use <code>as.numeric()</code> to convert to a number</li>
</ul>
<pre class="r"><code>imdb %&gt;%
  html_nodes(&quot;.lister-item-content p .runtime&quot;) %&gt;%
  html_text() %&gt;%
  str_split(&quot; &quot;) %&gt;%
  map_chr(1) %&gt;%
  as.numeric() -&gt; movie_runtime

movie_runtime</code></pre>
<pre><code>##  [1] 142 175 152 202 201 154 195 161  96 148 139 178 142 179 136 146 124
## [18] 133 207 169 130 125 169 189 116 106 127 110 118 121 130 139 161 117
## [35] 149 106 112 130 151 150 113 155 119  88 137 155  89 116 115 147</code></pre>
</div>
<div id="genre" class="section level3">
<h3>Genre</h3>
<p><img src="/img/blog_ws_imdb_movie_genre_border.png" width="80%" style="display: block; margin: auto;" /></p>
<p>The genre of the movie can be located in the following way:</p>
<ul>
<li><code>&lt;span&gt;</code> tag identified by the class <code>.genre</code></li>
<li>nested inside a paragraph (<code>&lt;p&gt;</code>)</li>
<li>part of section identified by the class <code>.lister-item-content</code></li>
</ul>
<pre class="r"><code>imdb %&gt;%
  html_nodes(&quot;.lister-item-content p .genre&quot;) %&gt;%
  html_text() </code></pre>
<pre><code>##  [1] &quot;\nDrama            &quot;                       
##  [2] &quot;\nCrime, Drama            &quot;                
##  [3] &quot;\nAction, Crime, Drama            &quot;        
##  [4] &quot;\nCrime, Drama            &quot;                
##  [5] &quot;\nAdventure, Drama, Fantasy            &quot;   
##  [6] &quot;\nCrime, Drama            &quot;                
##  [7] &quot;\nBiography, Drama, History            &quot;   
##  [8] &quot;\nWestern            &quot;                     
##  [9] &quot;\nDrama            &quot;                       
## [10] &quot;\nAction, Adventure, Sci-Fi            &quot;   
## [11] &quot;\nDrama            &quot;                       
## [12] &quot;\nAdventure, Drama, Fantasy            &quot;   
## [13] &quot;\nDrama, Romance            &quot;              
## [14] &quot;\nAdventure, Drama, Fantasy            &quot;   
## [15] &quot;\nAction, Sci-Fi            &quot;              
## [16] &quot;\nBiography, Crime, Drama            &quot;     
## [17] &quot;\nAction, Adventure, Fantasy            &quot;  
## [18] &quot;\nDrama            &quot;                       
## [19] &quot;\nAdventure, Drama            &quot;            
## [20] &quot;\nAdventure, Drama, Sci-Fi            &quot;    
## [21] &quot;\nCrime, Drama            &quot;                
## [22] &quot;\nAnimation, Adventure, Family            &quot;
## [23] &quot;\nDrama, War            &quot;                  
## [24] &quot;\nCrime, Drama, Fantasy            &quot;       
## [25] &quot;\nComedy, Drama, Romance            &quot;      
## [26] &quot;\nCrime, Mystery, Thriller            &quot;    
## [27] &quot;\nCrime, Drama, Mystery            &quot;       
## [28] &quot;\nAction, Crime, Drama            &quot;        
## [29] &quot;\nCrime, Drama, Thriller            &quot;      
## [30] &quot;\nAction, Adventure, Fantasy            &quot;  
## [31] &quot;\nDrama, Family, Fantasy            &quot;      
## [32] &quot;\nCrime, Thriller            &quot;             
## [33] &quot;\nAction, Biography, Drama            &quot;    
## [34] &quot;\nAnimation, Action, Adventure            &quot;
## [35] &quot;\nAction, Adventure, Sci-Fi            &quot;   
## [36] &quot;\nDrama, Music            &quot;                
## [37] &quot;\nBiography, Comedy, Drama            &quot;    
## [38] &quot;\nDrama, Mystery, Sci-Fi            &quot;      
## [39] &quot;\nCrime, Drama, Thriller            &quot;      
## [40] &quot;\nBiography, Drama, Music            &quot;     
## [41] &quot;\nMystery, Thriller            &quot;           
## [42] &quot;\nAction, Adventure, Drama            &quot;    
## [43] &quot;\nDrama            &quot;                       
## [44] &quot;\nAnimation, Adventure, Drama            &quot; 
## [45] &quot;\nAction, Sci-Fi            &quot;              
## [46] &quot;\nDrama            &quot;                       
## [47] &quot;\nAnimation, Drama, War            &quot;       
## [48] &quot;\nAdventure, Comedy, Sci-Fi            &quot;   
## [49] &quot;\nAction, Adventure            &quot;           
## [50] &quot;\nDrama, War            &quot;</code></pre>
<p>The output includes <code>\n</code> and white space, both of which will be removed using
<code>str_trim()</code>.</p>
<pre class="r"><code>imdb %&gt;%
  html_nodes(&quot;.lister-item-content p .genre&quot;) %&gt;%
  html_text() %&gt;%
  str_trim() -&gt; movie_genre

movie_genre</code></pre>
<pre><code>##  [1] &quot;Drama&quot;                        &quot;Crime, Drama&quot;                
##  [3] &quot;Action, Crime, Drama&quot;         &quot;Crime, Drama&quot;                
##  [5] &quot;Adventure, Drama, Fantasy&quot;    &quot;Crime, Drama&quot;                
##  [7] &quot;Biography, Drama, History&quot;    &quot;Western&quot;                     
##  [9] &quot;Drama&quot;                        &quot;Action, Adventure, Sci-Fi&quot;   
## [11] &quot;Drama&quot;                        &quot;Adventure, Drama, Fantasy&quot;   
## [13] &quot;Drama, Romance&quot;               &quot;Adventure, Drama, Fantasy&quot;   
## [15] &quot;Action, Sci-Fi&quot;               &quot;Biography, Crime, Drama&quot;     
## [17] &quot;Action, Adventure, Fantasy&quot;   &quot;Drama&quot;                       
## [19] &quot;Adventure, Drama&quot;             &quot;Adventure, Drama, Sci-Fi&quot;    
## [21] &quot;Crime, Drama&quot;                 &quot;Animation, Adventure, Family&quot;
## [23] &quot;Drama, War&quot;                   &quot;Crime, Drama, Fantasy&quot;       
## [25] &quot;Comedy, Drama, Romance&quot;       &quot;Crime, Mystery, Thriller&quot;    
## [27] &quot;Crime, Drama, Mystery&quot;        &quot;Action, Crime, Drama&quot;        
## [29] &quot;Crime, Drama, Thriller&quot;       &quot;Action, Adventure, Fantasy&quot;  
## [31] &quot;Drama, Family, Fantasy&quot;       &quot;Crime, Thriller&quot;             
## [33] &quot;Action, Biography, Drama&quot;     &quot;Animation, Action, Adventure&quot;
## [35] &quot;Action, Adventure, Sci-Fi&quot;    &quot;Drama, Music&quot;                
## [37] &quot;Biography, Comedy, Drama&quot;     &quot;Drama, Mystery, Sci-Fi&quot;      
## [39] &quot;Crime, Drama, Thriller&quot;       &quot;Biography, Drama, Music&quot;     
## [41] &quot;Mystery, Thriller&quot;            &quot;Action, Adventure, Drama&quot;    
## [43] &quot;Drama&quot;                        &quot;Animation, Adventure, Drama&quot; 
## [45] &quot;Action, Sci-Fi&quot;               &quot;Drama&quot;                       
## [47] &quot;Animation, Drama, War&quot;        &quot;Adventure, Comedy, Sci-Fi&quot;   
## [49] &quot;Action, Adventure&quot;            &quot;Drama, War&quot;</code></pre>
</div>
<div id="rating-1" class="section level3">
<h3>Rating</h3>
<p><img src="/img/blog_ws_imdb_movie_rating_border.png" width="80%" style="display: block; margin: auto;" /></p>
<p>The rating of the movie can be located in the following way:</p>
<ul>
<li>part of the section identified by the class <code>.ratings-imdb-rating</code></li>
<li>nested within the section identified by the class <code>.ratings-bar</code></li>
<li>the rating is present within the <code>&lt;strong&gt;</code> tag as well as in the
<code>data-value</code> attribute</li>
<li>instead of using <code>html_text()</code>, we will use <code>html_attr()</code> to extract the
value of the attribute <code>data-value</code></li>
</ul>
<p>Try using <code>html_text()</code> and see what happens! You may include the <code>&lt;strong&gt;</code> tag
or the classes associated with <code>&lt;span&gt;</code> tag as well.</p>
<pre class="r"><code>imdb %&gt;%
  html_nodes(&quot;.ratings-bar .ratings-imdb-rating&quot;) %&gt;%
  html_attr(&quot;data-value&quot;) </code></pre>
<pre><code>##  [1] &quot;9.3&quot; &quot;9.2&quot; &quot;9&quot;   &quot;9&quot;   &quot;8.9&quot; &quot;8.9&quot; &quot;8.9&quot; &quot;8.9&quot; &quot;8.9&quot; &quot;8.8&quot; &quot;8.8&quot;
## [12] &quot;8.8&quot; &quot;8.8&quot; &quot;8.7&quot; &quot;8.7&quot; &quot;8.7&quot; &quot;8.7&quot; &quot;8.7&quot; &quot;8.7&quot; &quot;8.6&quot; &quot;8.6&quot; &quot;8.6&quot;
## [23] &quot;8.6&quot; &quot;8.6&quot; &quot;8.6&quot; &quot;8.6&quot; &quot;8.6&quot; &quot;8.6&quot; &quot;8.6&quot; &quot;8.6&quot; &quot;8.6&quot; &quot;8.5&quot; &quot;8.5&quot;
## [34] &quot;8.5&quot; &quot;8.5&quot; &quot;8.5&quot; &quot;8.5&quot; &quot;8.5&quot; &quot;8.5&quot; &quot;8.5&quot; &quot;8.5&quot; &quot;8.5&quot; &quot;8.5&quot; &quot;8.5&quot;
## [45] &quot;8.5&quot; &quot;8.5&quot; &quot;8.5&quot; &quot;8.5&quot; &quot;8.5&quot; &quot;8.5&quot;</code></pre>
<p>Since rating is returned as a character vector, we will use <code>as.numeric()</code> to
convert it into a number.</p>
<pre class="r"><code>imdb %&gt;%
  html_nodes(&quot;.ratings-bar .ratings-imdb-rating&quot;) %&gt;%
  html_attr(&quot;data-value&quot;) %&gt;% 
  as.numeric() -&gt; movie_rating

movie_rating</code></pre>
<pre><code>##  [1] 9.3 9.2 9.0 9.0 8.9 8.9 8.9 8.9 8.9 8.8 8.8 8.8 8.8 8.7 8.7 8.7 8.7
## [18] 8.7 8.7 8.6 8.6 8.6 8.6 8.6 8.6 8.6 8.6 8.6 8.6 8.6 8.6 8.5 8.5 8.5
## [35] 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5 8.5</code></pre>
</div>
<div id="xpath" class="section level3">
<h3>XPATH</h3>
<p><img src="/img/blog_ws_html_xpath_border.png" width="80%" style="display: block; margin: auto;" /></p>
<p>To extract votes from the web page, we will use a different technique. In this
case, we will use <strong>xpath</strong> and <strong>attributes</strong> to locate the total number of
votes received by the top 50 movies.</p>
<p><strong>xpath</strong> is specified using the following:</p>
<ul>
<li>tab</li>
<li>attribute name</li>
<li>attribute value</li>
</ul>
</div>
<div id="votes" class="section level3">
<h3>Votes</h3>
<p><img src="/img/blog_ws_imdb_movie_votes_border.png" width="80%" style="display: block; margin: auto;" />
In case of votes, they are the following:</p>
<ul>
<li><code>meta</code></li>
<li><code>itemprop</code></li>
<li><code>ratingCount</code></li>
</ul>
<p>Next, we are not looking to extract text value as we did in the previous examples
using <code>html_text()</code>. Here, we need to extract the value assigned to the
<code>content</code> attribute within the <code>&lt;meta&gt;</code> tag using <code>html_attr()</code>.</p>
<pre class="r"><code>imdb %&gt;%
  html_nodes(xpath = &#39;//meta[@itemprop=&quot;ratingCount&quot;]&#39;) %&gt;% 
  html_attr(&#39;content&#39;) </code></pre>
<pre><code>##  [1] &quot;2072234&quot; &quot;1421858&quot; &quot;2038192&quot; &quot;986722&quot;  &quot;1475228&quot; &quot;1620525&quot; &quot;1073941&quot;
##  [8] &quot;615037&quot;  &quot;585330&quot;  &quot;1816814&quot; &quot;1658255&quot; &quot;1491788&quot; &quot;1588549&quot; &quot;1334175&quot;
## [15] &quot;1488615&quot; &quot;894737&quot;  &quot;1039788&quot; &quot;822026&quot;  &quot;279949&quot;  &quot;1276303&quot; &quot;637576&quot; 
## [22] &quot;549215&quot;  &quot;1095877&quot; &quot;1000529&quot; &quot;545073&quot;  &quot;897347&quot;  &quot;1271115&quot; &quot;913037&quot; 
## [29] &quot;1118408&quot; &quot;1109433&quot; &quot;352753&quot;  &quot;38978&quot;   &quot;118321&quot;  &quot;172855&quot;  &quot;616710&quot; 
## [36] &quot;605162&quot;  &quot;666065&quot;  &quot;1052597&quot; &quot;1063762&quot; &quot;633432&quot;  &quot;1021256&quot; &quot;1197974&quot;
## [43] &quot;941670&quot;  &quot;822889&quot;  &quot;897372&quot;  &quot;198316&quot;  &quot;192593&quot;  &quot;922864&quot;  &quot;802805&quot; 
## [50] &quot;542139&quot;</code></pre>
<p>Finally, we convert the votes to a number using <code>as.numeric()</code>.</p>
<pre class="r"><code>imdb %&gt;%
  html_nodes(xpath = &#39;//meta[@itemprop=&quot;ratingCount&quot;]&#39;) %&gt;% 
  html_attr(&#39;content&#39;) %&gt;% 
  as.numeric() -&gt; movie_votes

movie_votes</code></pre>
<pre><code>##  [1] 2072234 1421858 2038192  986722 1475228 1620525 1073941  615037
##  [9]  585330 1816814 1658255 1491788 1588549 1334175 1488615  894737
## [17] 1039788  822026  279949 1276303  637576  549215 1095877 1000529
## [25]  545073  897347 1271115  913037 1118408 1109433  352753   38978
## [33]  118321  172855  616710  605162  666065 1052597 1063762  633432
## [41] 1021256 1197974  941670  822889  897372  198316  192593  922864
## [49]  802805  542139</code></pre>
</div>
<div id="revenue" class="section level3">
<h3>Revenue</h3>
<p><img src="/img/blog_ws_imdb_movie_revenue_border.png" width="80%" style="display: block; margin: auto;" /></p>
<p>We wanted to extract both revenue and votes without using <strong>xpath</strong> but the way
in which they are structured in the HTML code forced us to use <strong>xpath</strong> to
extract votes. If you look at the HTML code, both votes and revenue are located
inside the same tag with the same attribute name and value i.e. there is no
distinct way to identify either of them.</p>
<p>In case of revenue, the <strong>xpath</strong> details are as follows:</p>
<ul>
<li><code>&lt;span&gt;</code></li>
<li><code>name</code></li>
<li><code>nv</code></li>
</ul>
<p>Next, we will use <code>html_text()</code> to extract the revenue.</p>
<pre class="r"><code>imdb %&gt;%
  html_nodes(xpath = &#39;//span[@name=&quot;nv&quot;]&#39;) %&gt;%
  html_text() </code></pre>
<pre><code>##  [1] &quot;2,072,234&quot; &quot;$28.34M&quot;   &quot;1,421,858&quot; &quot;$134.97M&quot;  &quot;2,038,192&quot;
##  [6] &quot;$534.86M&quot;  &quot;986,722&quot;   &quot;$57.30M&quot;   &quot;1,475,228&quot; &quot;$377.85M&quot; 
## [11] &quot;1,620,525&quot; &quot;$107.93M&quot;  &quot;1,073,941&quot; &quot;$96.07M&quot;   &quot;615,037&quot;  
## [16] &quot;$6.10M&quot;    &quot;585,330&quot;   &quot;$4.36M&quot;    &quot;1,816,814&quot; &quot;$292.58M&quot; 
## [21] &quot;1,658,255&quot; &quot;$37.03M&quot;   &quot;1,491,788&quot; &quot;$315.54M&quot;  &quot;1,588,549&quot;
## [26] &quot;$330.25M&quot;  &quot;1,334,175&quot; &quot;$342.55M&quot;  &quot;1,488,615&quot; &quot;$171.48M&quot; 
## [31] &quot;894,737&quot;   &quot;$46.84M&quot;   &quot;1,039,788&quot; &quot;$290.48M&quot;  &quot;822,026&quot;  
## [36] &quot;$112.00M&quot;  &quot;279,949&quot;   &quot;$0.27M&quot;    &quot;1,276,303&quot; &quot;$188.02M&quot; 
## [41] &quot;637,576&quot;   &quot;$7.56M&quot;    &quot;549,215&quot;   &quot;$10.06M&quot;   &quot;1,095,877&quot;
## [46] &quot;$216.54M&quot;  &quot;1,000,529&quot; &quot;$136.80M&quot;  &quot;545,073&quot;   &quot;$57.60M&quot;  
## [51] &quot;897,347&quot;   &quot;$23.34M&quot;   &quot;1,271,115&quot; &quot;$100.13M&quot;  &quot;913,037&quot;  
## [56] &quot;$19.50M&quot;   &quot;1,118,408&quot; &quot;$130.74M&quot;  &quot;1,109,433&quot; &quot;$322.74M&quot; 
## [61] &quot;352,753&quot;   &quot;38,978&quot;    &quot;$1.19M&quot;    &quot;118,321&quot;   &quot;$12.39M&quot;  
## [66] &quot;172,855&quot;   &quot;$190.24M&quot;  &quot;616,710&quot;   &quot;$678.82M&quot;  &quot;605,162&quot;  
## [71] &quot;$13.09M&quot;   &quot;666,065&quot;   &quot;$13.18M&quot;   &quot;1,052,597&quot; &quot;$53.09M&quot;  
## [76] &quot;1,063,762&quot; &quot;$132.38M&quot;  &quot;633,432&quot;   &quot;$32.57M&quot;   &quot;1,021,256&quot;
## [81] &quot;$25.54M&quot;   &quot;1,197,974&quot; &quot;$187.71M&quot;  &quot;941,670&quot;   &quot;$6.72M&quot;   
## [86] &quot;822,889&quot;   &quot;$312.90M&quot;  &quot;897,372&quot;   &quot;$204.84M&quot;  &quot;198,316&quot;  
## [91] &quot;$11.99M&quot;   &quot;192,593&quot;   &quot;922,864&quot;   &quot;$210.61M&quot;  &quot;802,805&quot;  
## [96] &quot;$248.16M&quot;  &quot;542,139&quot;   &quot;$83.47M&quot;</code></pre>
<p>To extract the revenue as a number, we need to do some string hacking as
follows:</p>
<ul>
<li>extract values that begin with <code>$</code></li>
<li>omit missing values</li>
<li>convert values to character using <code>as.character()</code></li>
<li>append NA where revenue is missing (rank 31 and 47)</li>
<li>remove <code>$</code> and <code>M</code></li>
<li>convert to number using <code>as.numeric()</code></li>
</ul>
<pre class="r"><code>imdb %&gt;%
  html_nodes(xpath = &#39;//span[@name=&quot;nv&quot;]&#39;) %&gt;%
  html_text() %&gt;%
  str_extract(pattern = &quot;^\\$.*&quot;) %&gt;%
  na.omit() %&gt;%
  as.character() %&gt;%
  append(values = NA, after = 30) %&gt;%
  append(values = NA, after = 46) %&gt;%
  str_sub(start = 2, end = nchar(.) - 1) %&gt;%
  as.numeric() -&gt; movie_revenue

movie_revenue</code></pre>
<pre><code>##  [1]  28.34 134.97 534.86  57.30 377.85 107.93  96.07   6.10   4.36 292.58
## [11]  37.03 315.54 330.25 342.55 171.48  46.84 290.48 112.00   0.27 188.02
## [21]   7.56  10.06 216.54 136.80  57.60  23.34 100.13  19.50 130.74 322.74
## [31]     NA   1.19  12.39 190.24 678.82  13.09  13.18  53.09 132.38  32.57
## [41]  25.54 187.71   6.72 312.90 204.84  11.99     NA 210.61 248.16  83.47</code></pre>
</div>
<div id="putting-it-all-together-1" class="section level3">
<h3>Putting it all together…</h3>
<pre class="r"><code>top_50 &lt;- tibble(title = movie_title, release = movie_year, 
    `runtime (mins)` = movie_runtime, genre = movie_genre, rating = movie_rating, 
    votes = movie_votes, `revenue ($ millions)` = movie_revenue)

top_50</code></pre>
<pre><code>## # A tibble: 50 x 7
##    title    release `runtime (mins)` genre   rating  votes `revenue ($ mil~
##    &lt;chr&gt;      &lt;dbl&gt;            &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;            &lt;dbl&gt;
##  1 The Sha~    1994              142 Drama      9.3 2.07e6            28.3 
##  2 The God~    1972              175 Crime,~    9.2 1.42e6           135.  
##  3 The Dar~    2008              152 Action~    9   2.04e6           535.  
##  4 The God~    1974              202 Crime,~    9   9.87e5            57.3 
##  5 The Lor~    2003              201 Advent~    8.9 1.48e6           378.  
##  6 Pulp Fi~    1994              154 Crime,~    8.9 1.62e6           108.  
##  7 Schindl~    1993              195 Biogra~    8.9 1.07e6            96.1 
##  8 Il buon~    1966              161 Western    8.9 6.15e5             6.1 
##  9 12 Angr~    1957               96 Drama      8.9 5.85e5             4.36
## 10 Incepti~    2010              148 Action~    8.8 1.82e6           293.  
## # ... with 40 more rows</code></pre>
<hr>
<p><a href="https://pkgs.rsquaredacademy.com/" target="_blank"><img src="/img/ad_packages.png" width="100%" alt="packages ad" style="text-decoration: none;"></a></p>
<hr>
</div>
</div>
<div id="top-websites" class="section level2">
<h2>Top Websites</h2>
<p><strong>Unfortunately, we had to drop this case study as the HTML code changed while we
were working on this blog post. Remember, the third point we mentioned in the
things to keep in mind, where we had warned that the design or underlying HTML
code of the website may change. It just happened as we were finalizing this
post.</strong></p>
</div>
<div id="rbi-governors" class="section level2">
<h2>RBI Governors</h2>
<p><img src="/img/blog_ws_rbi_governors_border.png" width="80%" style="display: block; margin: auto;" /></p>
<p>In this case study, we are going to extract the list of
RBI (Reserve Bank of India) Governors. The author of this blog post comes from
an Economics background and as such was intereseted in knowing the professional
background of the Governors prior to their taking charge at India’s central
bank. We will extact the following details:</p>
<ul>
<li>name</li>
<li>start of term</li>
<li>end of term</li>
<li>term (in days)</li>
<li>background</li>
</ul>
<div id="robotstxt-2" class="section level3">
<h3>robotstxt</h3>
<p>Let us check if we can scrape the data from Wikipedia website using
<code>paths_allowed()</code> from <strong>robotstxt</strong> package.</p>
<pre class="r"><code>paths_allowed(
  paths = c(&quot;https://en.wikipedia.org/wiki/List_of_Governors_of_Reserve_Bank_of_India&quot;)
)</code></pre>
<pre><code>## 
 en.wikipedia.org</code></pre>
<pre><code>## [1] TRUE</code></pre>
<p>Since it has returned <code>TRUE</code>, we will go ahead and download the web page using
<code>read_html()</code> from <strong>xml2</strong> package.</p>
<pre class="r"><code>rbi_guv &lt;- read_html(&quot;https://en.wikipedia.org/wiki/List_of_Governors_of_Reserve_Bank_of_India&quot;)
rbi_guv</code></pre>
<pre><code>## {xml_document}
## &lt;html class=&quot;client-nojs&quot; lang=&quot;en&quot; dir=&quot;ltr&quot;&gt;
## [1] &lt;head&gt;\n&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset= ...
## [2] &lt;body class=&quot;mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-sub ...</code></pre>
</div>
<div id="list-of-governors" class="section level3">
<h3>List of Governors</h3>
<p>The data in the Wikipedia page is luckily structured as a table and we can
extract it using <code>html_table()</code>.</p>
<pre class="r"><code>rbi_guv %&gt;%
  html_nodes(&quot;table&quot;) %&gt;%
  html_table() </code></pre>
<pre><code>## [[1]]
##                                            Governor of the Reserve Bank of India
## 1 IncumbentShaktikanta Das, IASsince 12 December 2018; 3 months ago (2018-12-12)
## 2                                                                      Appointer
## 3                                                                    Term length
## 4                                                        Constituting instrument
## 5                                                               Inaugural holder
## 6                                                                      Formation
## 7                                                                         Deputy
## 8                                                                        Website
##                                            Governor of the Reserve Bank of India
## 1 IncumbentShaktikanta Das, IASsince 12 December 2018; 3 months ago (2018-12-12)
## 2                                          Appointments Committee of the Cabinet
## 3                                                                    Three years
## 4                                                Reserve Bank of India Act, 1934
## 5                                                      Osborne Smith (1935–1937)
## 6                                        1 April 1935; 84 years ago (1935-04-01)
## 7                                  Deputy Governors of the Reserve Bank of India
## 8                                                                     rbi.org.in
## 
## [[2]]
##    No.         Officeholder Portrait        Term start          Term end
## 1    1        Osborne Smith       NA      1 April 1935      30 June 1937
## 2    2   James Braid Taylor       NA       1 July 1937  17 February 1943
## 3    3       C. D. Deshmukh       NA  11 August 1943ii       30 May 1949
## 4    4     Benegal Rama Rau       NA       1 July 1949   14 January 1957
## 5    5    K. G. Ambegaonkar       NA   14 January 1957  28 February 1957
## 6    6     H. V. R. Iyengar       NA      1 March 1957  28 February 1962
## 7    7   P. C. Bhattacharya       NA      1 March 1962      30 June 1967
## 8    8     Lakshmi Kant Jha       NA       1 July 1967        3 May 1970
## 9    9        B. N. Adarkar       NA        4 May 1970      15 June 1970
## 10  10 Sarukkai Jagannathan       NA      16 June 1970       19 May 1975
## 11  11      N. C. Sen Gupta       NA       19 May 1975    19 August 1975
## 12  12           K. R. Puri       NA    20 August 1975        2 May 1977
## 13  13        M. Narasimham       NA        3 May 1977  30 November 1977
## 14  14          I. G. Patel       NA   1 December 1977 15 September 1982
## 15  15       Manmohan Singh       NA 16 September 1982   14 January 1985
## 16  16         Amitav Ghosh       NA   15 January 1985   4 February 1985
## 17  17       R. N. Malhotra       NA   4 February 1985  22 December 1990
## 18  18    S. Venkitaramanan       NA  22 December 1990  21 December 1992
## 19  19        C. Rangarajan       NA  22 December 1992  21 November 1997
## 20  20          Bimal Jalan       NA  22 November 1997  6 September 2003
## 21  21   Y. Venugopal Reddy       NA  6 September 2003  5 September 2008
## 22  22          D. Subbarao       NA  5 September 2008  4 September 2013
## 23  23       Raghuram Rajan       NA  4 September 2013  4 September 2016
## 24  24          Urjit Patel       NA  4 September 2016  11 December 2018
## 25  25      Shaktikanta Das       NA  12 December 2018         Incumbent
##    Term in office                                  Background
## 1        821 days                                      Banker
## 2       2057 days          Indian Civil Service (ICS) officer
## 3       2150 days                                 ICS officer
## 4       2754 days                                 ICS officer
## 5         45 days                                 ICS officer
## 6       1825 days                                 ICS officer
## 7       1947 days   Indian Audit and Accounts Service officer
## 8       1037 days                                 ICS officer
## 9         42 days                                   Economist
## 10      1798 days                                 ICS officer
## 11        92 days                                 ICS officer
## 12       621 days                                            
## 13       211 days        Career Reserve Bank of India officer
## 14      1749 days                                   Economist
## 15       851 days                                   Economist
## 16        20 days                                      Banker
## 17      2147 days Indian Administrative Service (IAS) officer
## 18       730 days                                 IAS officer
## 19      1795 days                                   Economist
## 20      2114 days                                   Economist
## 21      1826 days                                 IAS officer
## 22      1825 days                                 IAS officer
## 23      1096 days                                   Economist
## 24       947 days                                   Economist
## 25       118 days                                 IAS officer
##                                                                                                                                                      Prior office(s)
## 1                                                                                                                    Managing Governor of the Imperial Bank of India
## 2                                                                                             Deputy Governor of the Reserve Bank of India\n\nController of Currency
## 3                                                                                          Deputy Governor of the Reserve Bank of India\nCustodian of Enemy Property
## 4                                                          Ambassador of India to the United States\n\nAmbassador of India to Japan\n\nChairman of Bombay Port Trust
## 5                                                                                                                                                  Finance Secretary
## 6                                                                                                                                Chairman of the State Bank of India
## 7                                                                                          Chairman of the State Bank of India\nSecretary in the Ministry of Finance
## 8                                                                                                                           Secretary to the Prime Minister of India
## 9                                                                                                              Executive Director at the International Monetary Fund
## 10                                                                                                                              Executive Director at the World Bank
## 11                                                                                                                                                 Banking Secretary
## 12                                                                                                  Chairman and Managing Director of the Life Insurance Corporation
## 13                                                                                                                      Deputy Governor of the Reserve Bank of India
## 14 Director of the London School of Economics\n\nDeputy Administrator of the United Nations Development Programme\nChief Economic Adviser to the Government of India
## 15                                                                         Secretary in the Ministry of Finance\n\nChief Economic Adviser to the Government of India
## 16                                                                                    Deputy Governor of the Reserve Bank of India\n\nChairman of the Allahabad Bank
## 17                                                                                        Finance Secretary\n\nExecutive Director at the International Monetary Fund
## 18                                                                                                                                                 Finance Secretary
## 19                                                                                                                      Deputy Governor of the Reserve Bank of India
## 20                                                                       Finance Secretary\n\nBanking Secretary\n\nChief Economic Adviser to the Government of India
## 21                                                             Executive Director at the International Monetary Fund\n\nDeputy Governor of the Reserve Bank of India
## 22                                                                           Finance Secretary\n\nMember-Secretary of the Prime Minister&#39;s Economic Advisory Council
## 23                                                                                                                 Chief Economic Adviser to the Government of India
## 24                                                                                                                               Deputy Governor of the Reserve Bank
## 25                                             Member of the Fifteenth Finance Commission\nSherpa of India to the G20\nEconomic Affairs Secretary\nRevenue Secretary
##    Reference(s)
## 1           [1]
## 2           [2]
## 3              
## 4              
## 5              
## 6              
## 7              
## 8              
## 9              
## 10             
## 11             
## 12             
## 13             
## 14             
## 15             
## 16             
## 17             
## 18             
## 19             
## 20             
## 21             
## 22             
## 23             
## 24             
## 25    [3][4][5]
## 
## [[3]]
##   vte Governors of the Reserve Bank of India
## 1                                         NA
##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      vte Governors of the Reserve Bank of India
## 1 Osborne Smith (1935–37)\nJames Braid Taylor (1937–43)\nC. D. Deshmukh (1943–49)\nBenegal Rama Rau (1949–57)\nK. G. Ambegaonkar (1957)\nH. V. R. Iyengar (1957–62)\nP. C. Bhattacharya (1962–67)\nLakshmi Kant Jha (1967–70)\nB. N. Adarkar (1970)\nS. Jagannathan (1970–75)\nN. C. Sen Gupta (1975)\nK. R. Puri (1975–77)\nM. Narasimham (1977)\nI. G. Patel (1977–82)\nManmohan Singh (1982–85)\nAmitav Ghosh (1985)\nR. N. Malhotra (1985–90)\nS. Venkitaramanan (1990–92)\nC. Rangarajan (1992–97)\nBimal Jalan (1997–2003)\nY. Venugopal Reddy (2003–08)\nDuvvuri Subbarao (2008–13)\nRaghuram Rajan (2013–16)\nUrjit Patel (2016–2018)\nShaktikanta Das (2018–Incumbent)
##                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      vte Governors of the Reserve Bank of India
## 1 Osborne Smith (1935–37)\nJames Braid Taylor (1937–43)\nC. D. Deshmukh (1943–49)\nBenegal Rama Rau (1949–57)\nK. G. Ambegaonkar (1957)\nH. V. R. Iyengar (1957–62)\nP. C. Bhattacharya (1962–67)\nLakshmi Kant Jha (1967–70)\nB. N. Adarkar (1970)\nS. Jagannathan (1970–75)\nN. C. Sen Gupta (1975)\nK. R. Puri (1975–77)\nM. Narasimham (1977)\nI. G. Patel (1977–82)\nManmohan Singh (1982–85)\nAmitav Ghosh (1985)\nR. N. Malhotra (1985–90)\nS. Venkitaramanan (1990–92)\nC. Rangarajan (1992–97)\nBimal Jalan (1997–2003)\nY. Venugopal Reddy (2003–08)\nDuvvuri Subbarao (2008–13)\nRaghuram Rajan (2013–16)\nUrjit Patel (2016–2018)\nShaktikanta Das (2018–Incumbent)
##   vte Governors of the Reserve Bank of India
## 1                                         NA</code></pre>
<p>There are 2 tables in the web page and we are interested in the second table.
Using <code>extract2()</code> from the <strong>magrittr</strong> package, we will extract the table
containing the details of the Governors.</p>
<pre class="r"><code>rbi_guv %&gt;%
  html_nodes(&quot;table&quot;) %&gt;%
  html_table() %&gt;%
  extract2(2) -&gt; profile</code></pre>
</div>
<div id="sort" class="section level3">
<h3>Sort</h3>
<p>Let us arrange the data by number of days served. The <code>Term in office</code> column
contains this information but it also includes the text days. Let us split this
column into two columns, <code>term</code> and <code>days</code>, using <code>separate()</code> from tidyr and
then select the columns <code>Officeholder</code> and <code>term</code> and arrange it in descending
order using <code>desc()</code>.</p>
<pre class="r"><code>profile %&gt;%
  separate(`Term in office`, into = c(&quot;term&quot;, &quot;days&quot;)) %&gt;%
  select(Officeholder, term) %&gt;%
  arrange(desc(as.numeric(term)))</code></pre>
<pre><code>##            Officeholder term
## 1      Benegal Rama Rau 2754
## 2        C. D. Deshmukh 2150
## 3        R. N. Malhotra 2147
## 4           Bimal Jalan 2114
## 5    James Braid Taylor 2057
## 6    P. C. Bhattacharya 1947
## 7    Y. Venugopal Reddy 1826
## 8      H. V. R. Iyengar 1825
## 9           D. Subbarao 1825
## 10 Sarukkai Jagannathan 1798
## 11        C. Rangarajan 1795
## 12          I. G. Patel 1749
## 13       Raghuram Rajan 1096
## 14     Lakshmi Kant Jha 1037
## 15          Urjit Patel  947
## 16       Manmohan Singh  851
## 17        Osborne Smith  821
## 18    S. Venkitaramanan  730
## 19           K. R. Puri  621
## 20        M. Narasimham  211
## 21      Shaktikanta Das  118
## 22      N. C. Sen Gupta   92
## 23    K. G. Ambegaonkar   45
## 24        B. N. Adarkar   42
## 25         Amitav Ghosh   20</code></pre>
</div>
<div id="backgrounds" class="section level3">
<h3>Backgrounds</h3>
<p>What we are interested is in the background of the Governors? Use <code>count()</code>
from <strong>dplyr</strong> to look at the backgound of the Governors and the respective
counts.</p>
<pre class="r"><code>profile %&gt;%
  count(Background) </code></pre>
<pre><code>## # A tibble: 9 x 2
##   Background                                      n
##   &lt;chr&gt;                                       &lt;int&gt;
## 1 &quot;&quot;                                              1
## 2 Banker                                          2
## 3 Career Reserve Bank of India officer            1
## 4 Economist                                       7
## 5 IAS officer                                     4
## 6 ICS officer                                     7
## 7 Indian Administrative Service (IAS) officer     1
## 8 Indian Audit and Accounts Service officer       1
## 9 Indian Civil Service (ICS) officer              1</code></pre>
<p>Let us club some of the categories into <strong>Bureaucrats</strong> as they belong to the
Indian Administrative/Civil Services. The missing data will be renamed as <code>No Info</code>.
The category <code>Career Reserve Bank of India officer</code> is renamed as <code>RBI Officer</code>
to make it more concise.</p>
<pre class="r"><code>profile %&gt;%
  pull(Background) %&gt;%
  fct_collapse(
    Bureaucrats = c(&quot;IAS officer&quot;, &quot;ICS officer&quot;,
    &quot;Indian Administrative Service (IAS) officer&quot;,
    &quot;Indian Audit and Accounts Service officer&quot;,
    &quot;Indian Civil Service (ICS) officer&quot;),
    `No Info` = c(&quot;&quot;),
    `RBI Officer` = c(&quot;Career Reserve Bank of India officer&quot;)
  ) %&gt;%
  fct_count() %&gt;%
  rename(background = f, count = n) -&gt; backgrounds

backgrounds</code></pre>
<pre><code>## # A tibble: 5 x 2
##   background  count
##   &lt;fct&gt;       &lt;int&gt;
## 1 No Info         1
## 2 Banker          2
## 3 RBI Officer     1
## 4 Economist       7
## 5 Bureaucrats    14</code></pre>
<p>Hmmm.. So there were more bureaucrats than economists.</p>
<pre class="r"><code>backgrounds %&gt;%
  ggplot() +
  geom_col(aes(background, count), fill = &quot;blue&quot;) +
  xlab(&quot;Background&quot;) + ylab(&quot;Count&quot;) +
  ggtitle(&quot;Background of RBI Governors&quot;)</code></pre>
<p><img src="/post/2019-04-11-web-scraping_files/figure-html/rbi9-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="summary" class="section level2">
<h2>Summary</h2>
<ul>
<li>web scraping is the extraction of data from web sites</li>
<li>best for static &amp; well structured HTML pages</li>
<li>review robots.txt file<br />
</li>
<li>HTML code can change any time</li>
<li>if API is available, please use it</li>
<li>do not overwhelm websites with requests</li>
</ul>
<p><strong>To get in depth knowledge of R &amp; data science, you can
<a href="https://rsquared-academy.thinkific.com/">enroll here</a> for our free
online R courses.</strong></p>
</div>
